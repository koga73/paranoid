<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Paranoid</title>

		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width,initial-scale=1"/>
		<meta name="theme-color" content="#000"/>
		<meta name="msapplication-navbutton-color" content="#000"/>
		<meta name="apple-mobile-web-app-status-bar-style" content="#000"/>

		<link rel="stylesheet" href="css/styles.css" type="text/css"/>
	</head>
	<body>
		<div id="page" class="flex-v">
			<header v-cloak>
				<div class="wrap clr">
					<div class="logo">
						<a href="#" accesskey="0" v-bind:title="accessKeyShortcut + '0'">
							<h1>Paranoid</h1>
						</a>
						<a href="paranoid-portable.html" target="_blank" download title="Download the stand-alone paranoid-portable.html - verify the file checksum and run locally by opening the downloaded file in your browser">
							<em class="seo">Portable</em>
							<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="file-download" class="svg-inline--fa fa-file-download fa-w-12" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm76.45 211.36l-96.42 95.7c-6.65 6.61-17.39 6.61-24.04 0l-96.42-95.7C73.42 337.29 80.54 320 94.82 320H160v-80c0-8.84 7.16-16 16-16h32c8.84 0 16 7.16 16 16v80h65.18c14.28 0 21.4 17.29 11.27 27.36zM377 105L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128v-6.1c0-6.3-2.5-12.4-7-16.9z"></path></svg>
						</a>
					</div>
					<nav>
						<ul>
							<li>
								<a href="#preferences" v-bind:class="{active:route == 'preferences'}" accesskey="1" v-bind:title="'Preferences | ' + accessKeyShortcut + '1'">
									<span class="seo">Preferences</span>
									<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="cog" class="svg-inline--fa fa-cog fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"></path></svg>
								</a>
							</li>
							<li>
								<a href="#relays" v-bind:class="{active:route == 'relays'}" accesskey="2" v-bind:title="'Relays | ' + accessKeyShortcut + '2'">
									<span class="seo">Relays</span>
									<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="network-wired" class="svg-inline--fa fa-network-wired fa-w-20" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M640 264v-16c0-8.84-7.16-16-16-16H344v-40h72c17.67 0 32-14.33 32-32V32c0-17.67-14.33-32-32-32H224c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h72v40H16c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h104v40H64c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V352c0-17.67-14.33-32-32-32h-56v-40h304v40h-56c-17.67 0-32 14.33-32 32v128c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V352c0-17.67-14.33-32-32-32h-56v-40h104c8.84 0 16-7.16 16-16zM256 128V64h128v64H256zm-64 320H96v-64h96v64zm352 0h-96v-64h96v64z"></path></svg>
								</a>
							</li>
							<li>
								<a href="#accounts" v-bind:class="{active:route == 'accounts'}" accesskey="3" v-bind:title="'Accounts | ' + accessKeyShortcut + '3'">
									<span class="seo">Accounts</span>
									<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="user-circle" class="svg-inline--fa fa-user-circle fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"></path></svg>
								</a>
							</li>
						</ul>
					</nav>
				</div>
			</header>
			<main class="flex-grow" v-cloak>

				<preferences
					inline-template
					v-bind:_preferences.sync="preferences"
					v-bind:class="['component', {active:route == 'preferences'}]">

					<section id="preferences">
						<div class="wrap">
							<h2>Preferences</h2>
						</div>

						<section id="messages" class="bg-purp">
							<div class="wrap">
								<h3>Messages</h3>
								<div class="check-wrap">
									<input id="chkShowTimes" type="checkbox" v-model="messages.showTimes"/>
									<label for="chkShowTimes">
										<span>Show message times</span>
									</label>
								</div>
								<div class="check-wrap">
									<input id="chkDisableTextDecryptAnimation" type="checkbox" v-model="messages.disableDecryptAnimation"/>
									<label for="chkDisableTextDecryptAnimation">
										<span>Disable text decryption animation</span>
									</label>
								</div>
							</div>
						</section>

					</section>
				</preferences>

				<relays
					inline-template
					v-bind:_relays.sync="relays"
					v-bind:class="['component', {active:route == 'relays'}]">

					<section id="relays">
						<div class="wrap">
							<h2>Manage Relays</h2>
							<ul class="notes">
								<li>Your browser connects to one or more relays.</li>
								<li>Relays forward messages to clients and other relays.</li>
								<li>Relays <em title="you should assume that someone is storing every message">should not</em> store messages.</li>
							</ul>
						</div>
						<form ref="frmRelays" class="bg-purp">
							<div class="wrap">
								<div class="scroll-wrap">
									<table>
										<thead>
											<tr>
												<th>Enabled</th>
												<th>Name</th>
												<th>Address</th>
												<th>Passphrase</th>
												<th>Actions</th>
											</tr>
										</thead>
										<tbody>
											<tr v-for="(relay, index) in relays">
												<td>
													<div class="check-wrap">
														<input v-bind:id="'chkRelayEnabled_' + relay.name" type="checkbox" v-model="relay.enabled" v-bind:disabled="relay.fromServer"/>
														<label v-bind:for="'chkRelayEnabled_' + relay.name" v-bind:title="relay.fromServer ? 'This relay was added by the server and cannot be disabled' : ''">
															<span class="seo">{{relay.enabled ? "Currently Enabled" : "Currently Disabled"}}</span>
														</label>
													</div>
												</td>
												<td>{{relay.name}}</td>
												<td>{{relay.address}}</td>
												<!-- TODO: Hide? -->
												<td>{{relay.passphrase}}</td>
												<td>
													<button class="btn" v-on:click="handler_relay_remove($event, relay, index)" v-bind:disabled="relay.fromServer" v-bind:title="(relay.fromServer) ? 'This relay was added by the server and cannot be removed' : 'Remove this relay from your browser'">Remove</button>
													<button class="btn" v-on:click="handler_relay_export($event, relay)" title="Export this relay to a downloadable json file">Export</button>
												</td>
											</tr>
											<tr>
												<td>
													<div class="check-wrap">
														<input id="chkRelayNewEnabled" type="checkbox" v-model="relayNew.enabled"/>
														<label for="chkRelayNewEnabled">
															<span class="seo">{{relayNew.enabled ? "Currently Enabled" : "Currently Disabled"}}</span>
														</label>
													</div>
												</td>
												<td>
													<div class="input-wrap">
														<label for="txtRelayNewName" class="seo">Name</label>
														<input type="text" id="txtRelayNewName" v-model="relayNew.name" placeholder="Name" required minlength="1" maxlength="32" pattern="^[\w\s!@#$%^&*().:|/\\?-]+$" autocomplete="off"/>
													</div>
												</td>
												<td>
													<div class="input-wrap">
														<label for="txtRelayNewAddress" class="seo">URL or IP Address</label>
														<input type="text" id="txtRelayNewAddress" v-model="relayNew.address" placeholder="URL or IP Address" required minlength="1" pattern="^[\w\/.:-]+$" autocomplete="off"/>
													</div>
												</td>
												<td>
													<div class="input-wrap">
														<label for="txtRelayPassphrase" class="seo">Passphrase</label>
														<input type="text" id="txtRelayPassphrase" v-model="relayNew.passphrase" placeholder="Passphrase" required minlength="1" autocomplete="off"/>
													</div>
												</td>
												<td>
													<button class="btn" type="submit" v-on:click="handler_relay_add($event)" title="Add this relay to your browser">Add</button>
												</td>
											</tr>
										</tbody>
									</table>
									<div class="btn-wrap">
										<button class="btn" v-on:click="handler_relay_import($event)" title="Import a relay from your device into your browser">Import</button>
									</div>
								</div>
							</div>
						</form>
						<div class="wrap">
							<div class="btn-wrap">
								<button class="btn" v-on:click="handler_relays_export" title="Export all relays to a downloadable json file">Export all<span class="seo">replays</span></button>
								<button class="btn" v-on:click="handler_relays_import" title="Import a json file from your device and populate all relays">Import all<span class="seo">replays</span></button>
							</div>
						</div>
					</section>
				</relays>

				<accounts
					inline-template
					v-bind:_accounts.sync="accounts"
					v-bind:class="['component', {active:route == 'accounts'}]">

					<section id="accounts">
						<div class="wrap">
							<h2>Accounts</h2>
							<ul class="notes">
								<li title="Use private browsing or clear your localStorage to remove all data from your browser">Your browser stores one or more accounts.</li>
								<li>An account consists of a username and an encryption key pair.</li>
								<li>Your public key is shared with relays while your private key is kept secret <span title="or you can export your username and keys">in your browser.</span></li>
								<li>To "login" you must have your username and key pair.</li>
								<li>After 7 days of account inactivity the relay will forget you and someone else can claim your username.</li>
							</ul>
						</div>
						<form ref="frmAccounts" class="bg-purp">
							<div class="wrap">
								<div class="scroll-wrap">
									<table>
										<thead>
											<tr>
												<th>Username</th>
												<th>Public Key</th>
												<th>Private Key</th>
												<th>Actions</th>
											</tr>
										</thead>
										<tbody>
											<tr v-for="(account, index) in accounts">
												<td>{{account.username}}</td>
												<td>{{account.publicKey || "N/A"}}</td>
												<td>
													<div class="check-wrap" v-if="account.privateKey">
														<input v-bind:id="'chkAccountShowPrivate_' + account.username" type="checkbox" v-model="account.showPrivate"/>
														<label v-bind:for="'chkAccountShowPrivate_' + account.username">
															{{!account.showPrivate ? "Show" : "Hide"}}
														</label>
													</div>
													<span class="private" v-if="account.privateKey && account.showPrivate">
														{{account.privateKey}}
													</span>
													<span class="private-na" v-if="!account.privateKey">N/A</span>
												</td>
												<td>
													<button class="btn" v-on:click="handler_account_remove($event, account, index)" v-bind:disabled="account.fromServer" v-bind:title="(account.fromServer) ? 'This account was added by the server and cannot be removed' : 'Remove this account from your browser'">Remove</button>
													<button class="btn" v-on:click="handler_account_export($event, account)" title="Export this account to a downloadable json file">Export</button>
													<button class="btn" v-if="account.publicKey && account.privateKey" v-on:click="handler_account_change($event, account)" v-bind:disabled="account.fromServer" v-bind:title="(account.fromServer) ? 'This account was added by the server and cannot be changed' : 'Generate new keys and register the new public key with the relay'">Change keys</button>
												</td>
											</tr>
											<tr>
												<td>
													<div class="input-wrap">
														<label for="txtAccountUsername" class="seo">Username</label>
														<input type="text" id="txtAccountUsername" v-model="accountNew.username" placeholder="Username" required minlength="1" maxlength="32" pattern="^[\w-]+$" autocomplete="off"/>
													</div>
												</td>
												<td colspan="2">
													<span>Key pair will be generated upon add</span>
												</td>
												<td>
													<button class="btn" type="submit" v-on:click="handler_account_add($event)" title="Add this account to your browser">Add</button>
												</td>
											</tr>
										</tbody>
									</table>
									<div class="btn-wrap">
										<button class="btn" v-on:click="handler_account_import($event)" title="Import an account from your device into your browser">Import</button>
									</div>
								</div>
							</div>
						</form>
						<div class="wrap">
							<div class="btn-wrap">
								<button class="btn" v-on:click="handler_accounts_export" title="Export all accounts to a downloadable json file">Export all<span class="seo">accounts</span></button>
								<button class="btn" v-on:click="handler_accounts_import" title="Import a json file from your device and populate all accounts">Import all<span class="seo">accounts</span></button>
							</div>
						</div>
					</section>
				</accounts>

				<chat
					inline-template
					v-bind:is-crypto-supported="isCryptoSupported"
					v-bind:preferences="preferences"
					v-bind:accounts="accounts"
					v-bind:context="context"
					v-bind:system-messages="systemMessages"
					v-bind:class="['component', {active:route == ''}]">

					<section id="chat" class="wrap-large">

						<div class="flex-v scroll-wrap">
							<div class="top flex-grow flex-h">
								<div class="left wrap-small flex-v panel">
									<h2>Chat{{(context) ? " - " + context.name : ""}}</h2>
									<div class="flex-grow">
										<div ref="messages-scroll" class="scroll-wrap">
											<ol class="messages" v-if="isCryptoSupported">

												<message
													inline-template
													v-bind:preferences-messages="preferences.messages"
													v-for="message in messages"
													v-bind:message="message"
													v-bind:key="message.time">

													<li v-bind:class="['clr', message.type, {self:message.self === true}]" v-bind:title="title">
														<span class="from"><span class="seo">From</span>{{message.from}}</span>
														<time v-if="preferencesMessages.showTimes === true">{{time}}</time>
														<span class="content">{{content}}</span>
													</li>
												</message>

											</ol>
											<p class="not-supported" v-if="!isCryptoSupported">Crypto is not supported by your browser<br/>Please use a modern browser such as Chrome or Firefox</p>
										</div>
									</div>
								</div>
								<aside class="right wrap-small flex-v panel">
									<div class="flex-v">
										<div class="flex-h">
											<h3 class="left flex-grow">Rooms</h3>
											<button class="right btn btn-new" v-on:click="handler_newRoom_click" title="New room">+</button>
										</div>
										<div class="flex-grow">
											<div class="scroll-wrap">
												<ul>
													<li v-for="room in rooms">
														<button v-bind:class="['btn btn-slim', {active:isRoomActive(room)}]" v-on:click="handler_room_click(room)">{{room.name}}</button>
													</li>
												</ul>
											</div>
										</div>
									</div>
									<div class="flex-v">
										<div class="flex-h">
											<h3 class="left flex-grow">Direct Message</h3>
											<button class="right btn btn-new" v-on:click="handler_newDirect_click" title="New direct message">+</button>
										</div>
										<div class="flex-grow">
											<div class="scroll-wrap">
												<p v-if="!users.length">No direct messages yet</p>
												<ul v-if="users.length">
													<li v-for="user in users">{{user.username}}</li>
												</ul>
											</div>
										</div>
									</div>
								</aside>
							</div>

							<form ref="frmChat" class="bottom flex-h">
								<div class="left wrap-small flex-h panel">
									<div class="message-input flex-grow flex-h">
										<div class="left flex-grow input-wrap">
											<label for="txtMessage" class="seo">Message</label>
											<textarea ref="txtMessage" id="txtMessage" v-model="message" placeholder="Message" required minlength="1" maxlength="255" autocomplete="off"></textarea>
										</div>
										<div class="right btn-wrap flex-v flex-center">
											<button type="submit" class="btn btn-icon" v-on:click="handler_message_send($event)">
												<span class="seo">Send</span>
												<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-circle-right" class="svg-inline--fa fa-arrow-circle-right fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zm-28.9 143.6l75.5 72.4H120c-13.3 0-24 10.7-24 24v16c0 13.3 10.7 24 24 24h182.6l-75.5 72.4c-9.7 9.3-9.9 24.8-.4 34.3l11 10.9c9.4 9.4 24.6 9.4 33.9 0L404.3 273c9.4-9.4 9.4-24.6 0-33.9L271.6 106.3c-9.4-9.4-24.6-9.4-33.9 0l-11 10.9c-9.5 9.6-9.3 25.1.4 34.4z"></path></svg>
											</button>
										</div>
									</div>
								</div>
								<aside class="right wrap-small panel">
									<div class="select-wrap flex-h">
										<div class="flex-v flex-center">
											<label for="sltUsername">Send as:</label>
										</div>
										<select id="sltUsername" class="flex-grow" v-model="username" v-on:change="handler_username_change">
											<option v-for="account in accounts" v-bind:value="account.username">{{account.username}}</option>
										</select>
									</div>
								</aside>
							</form>
						</div>

					</section>
				</chat>

			</main>
			<footer v-cloak>
				<div class="wrap">
					<p class="status" v-bind:title="connectionSummary">{{numConnected ? "CONNECTED: " + Math.floor(numConnected / totalConnections * 100) + "%" : "DISCONNECTED"}}</p>
					<!-- TODO: This should download from the relay rather than github to ensure mirrors -->
					<a href="https://github.com/koga73/paranoid/releases" target="_blank" title="Download Source Code">
						<span>Source code</span>
					</a>
				</div>
			</footer>
		</div>

		<script id="fromServer">
			/* BEGIN_REPLACE_FROM_SERVER */
			var ServerDefaults = {
				"accounts":[
					{
						"username":"Anonymous"
					}
				]
			};
			/* END_REPLACE_FROM_SERVER */
		</script>

		<script src="js/lib.js"></script>
		<script>
			/* Strings inline to make translation easier */
			(function(){
				OOP.namespace("Resources.Strings",
				OOP.construct({

					static:{
						CONNECTED:"Connected:",
						DISCONNECTED:"Disconnected:",

						ERROR_NETWORK:"A network error has occured. Please check your connection and try again.",
						ERROR_GENERAL:"An error has occured.",
						ERROR_UNCAUGHT:"An unexpected error has occured.",

						ERROR_INVALID_KEY:"invalid key",
						ERROR_INVALID_ARRAY_LENGTH:"invalid array length",
						ERROR_NO_DATA:"no data"
					}

				}));
			})();
		</script>
		<script src="js/site.js"></script>
	</body>
</html>