<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Paranoid</title>

		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width,initial-scale=1"/>
		<meta name="theme-color" content="#000"/>
		<meta name="msapplication-navbutton-color" content="#000"/>
		<meta name="apple-mobile-web-app-status-bar-style" content="#000"/>

		<link rel="stylesheet" href="css/styles.css" type="text/css"/>
	</head>
	<body>
		<div id="page">
			<header v-cloak>
				<div class="wrap clr">
					<a href="#" accesskey="0" v-bind:title="accessKeyShortcut + '0'">
						<h1>Paranoid</h1>
					</a>
					<nav>
						<ul>
							<li>
								<a href="#preferences" v-bind:class="{active:route == 'preferences'}" accesskey="1" v-bind:title="accessKeyShortcut + '1'">Preferences</a>
							</li>
							<li>
								<a href="#relays" v-bind:class="{active:route == 'relays'}" accesskey="2" v-bind:title="accessKeyShortcut + '2'">Relays</a>
							</li>
							<li>
								<a href="#accounts" v-bind:class="{active:route == 'accounts'}" accesskey="3" v-bind:title="accessKeyShortcut + '3'">Accounts</a>
							</li>
						</ul>
					</nav>
				</div>
			</header>
			<main v-cloak>

				<preferences inline-template v-bind:class="['component', {active:route == 'preferences'}]">
					<section id="preferences">
						<div class="wrap">
							<h2>Preferences</h2>
						</div>

						<section id="crypto" class="bg-purp">
							<div class="wrap">
								<h3>Crypto Plugins</h3>
								<strong class="notes"><em>DO NOT MODIFY THIS SECTION UNLESS YOU TRUST THE CODE YOU ARE EXECUTING!</em></strong>
								<ul class="notes">
									<li>Some ciphers are supported out of the box such as RSA and AES.</li>
									<li>To add a new cipher populate the "source" field with a link to javascript cipher code or raw javascript code</li>
								</ul>
								<button class="btn" v-if="!cryptoVisible" v-on:click="handler_showMeCrypto_click">I know what I'm doing</button>
								<form ref="frmCrypto" class="scroll-wrap" v-if="cryptoVisible">
									<table>
										<thead>
											<tr>
												<th>Name</th>
												<th>Type</th>
												<th>Source</th>
												<th>Actions</th>
											</tr>
										</thead>
										<tbody>
											<tr v-for="(cipher, index) in ciphers">
												<td>{{cipher.name}}</td>
												<td>{{cipher.type}}</td>
												<td>
													<div class="input-wrap">
														<textarea readonly>{{cipher.source}}</textarea>
													</div>
												</td>
												<td>
													<button class="btn" v-on:click="handler_cipher_remove($event, cipher, index)" v-bind:disabled="cipher.fromServer" v-bind:title="(cipher.fromServer) ? 'This plugin was added by the server and cannot be removed' : 'Remove this cipher - To fully unload the cipher from memory you will need to refresh the page'">Remove</button>
												</td>
											</tr>
											<tr>
												<td>
													<div class="input-wrap">
														<label for="txtCipherNewName" class="seo">Name</label>
														<input type="text" id="txtCipherNewName" v-model="cipherNew.name" placeholder="Name" required minlength="1" maxlength="32" pattern="^[\w-]+$" autocomplete="off"/>
													</div>
												</td>
												<td>
													<div class="select-wrap">
														<label for="sltType" class="seo">Type</label>
														<select id="sltType" v-model="cipherNew.type" required>
															<option v-for="cipherType in cipherTypes" value="cipherType">{{cipherType}}</option>
														</select>
													</div>
												</td>
												<td>
													<div class="input-wrap">
														<label for="txtCipherNewSource" class="seo" title="URL or raw javascript">Source</label>
														<textarea id="txtCipherNewSource" v-model="cipherNew.source" placeholder="Source" required></textarea>
													</div>
												</td>
												<td>
													<button class="btn" type="submit" v-on:click="handler_cipher_loadSource($event)" title="Load cipher plugin from source field">Load from source</button>
													<button class="btn" v-on:click="handler_cipher_loadDevice($event)" title="Load a cipher plugin from your device into your browser">Load from device</button>
												</td>
											</tr>
										</tbody>
									</table>
								</form>
							</div>
						</section>

					</section>
				</preferences>

				<relays inline-template v-bind:class="['component', {active:route == 'relays'}]">
					<section id="relays">
						<div class="wrap">
							<h2>Manage Relays</h2>
							<ul class="notes">
								<li>Your browser connects to one or more relays.</li>
								<li>Relays forward messages to clients and other relays.</li>
								<li>Relays <em title="you should assume that someone is storing every message">should not</em> store messages.</li>
							</ul>
						</div>
						<form ref="frmRelays" class="bg-purp">
							<div class="wrap">
								<div class="scroll-wrap">
									<table>
										<thead>
											<tr>
												<th>Enabled</th>
												<th>Name</th>
												<th>Address</th>
												<th>Actions</th>
											</tr>
										</thead>
										<tbody>
											<tr v-for="(relay, index) in relays">
												<td>
													<div class="check-wrap">
														<input v-bind:id="'chkRelayEnabled_' + relay.name" type="checkbox" v-model="relay.enabled"/>
														<label v-bind:for="'chkRelayEnabled_' + relay.name">
															<span class="seo">{{relay.enabled ? "Currently Enabled" : "Currently Disabled"}}</span>
														</label>
													</div>
												</td>
												<td>{{relay.name}}</td>
												<td>{{relay.address}}</td>
												<td>
													<button class="btn" v-on:click="handler_relay_remove($event, relay, index)" title="Remove this relay from your browser">Remove</button>
													<button class="btn" v-on:click="handler_relay_export($event, relay)" title="Export this relay to a downloadable json file">Export</button>
												</td>
											</tr>
											<tr>
												<td>
													<div class="check-wrap">
														<input id="chkRelayNewEnabled" type="checkbox" v-model="relayNew.enabled"/>
														<label for="chkRelayNewEnabled">
															<span class="seo">{{relayNew.enabled ? "Currently Enabled" : "Currently Disabled"}}</span>
														</label>
													</div>
												</td>
												<td>
													<div class="input-wrap">
														<label for="txtRelayNewName" class="seo">Name</label>
														<input type="text" id="txtRelayNewName" v-model="relayNew.name" placeholder="Name" required minlength="1" maxlength="32" pattern="^[\w\s!@#$%^&*().:|/\\?-]+$" autocomplete="off"/>
													</div>
												</td>
												<td>
													<div class="input-wrap">
														<label for="txtRelayNewAddress" class="seo">URL or IP Address</label>
														<input type="text" id="txtRelayNewAddress" v-model="relayNew.address" placeholder="URL or IP Address" required minlength="1" pattern="^[\w\/.:-]+$" autocomplete="off"/>
													</div>
												</td>
												<td>
													<button class="btn" type="submit" v-on:click="handler_relay_add($event)" title="Add this relay to your browser">Add</button>
												</td>
											</tr>
										</tbody>
									</table>
									<div class="btn-wrap">
										<button class="btn" v-on:click="handler_relay_import($event)" title="Import a relay from your device into your browser">Import</button>
									</div>
								</div>
							</div>
						</form>
						<div class="wrap">
							<div class="btn-wrap">
								<button class="btn" v-on:click="handler_relays_export" title="Export all relays to a downloadable json file">Export all<span class="seo">replays</span></button>
								<button class="btn" v-on:click="handler_relays_import" title="Import a json file from your device and populate all relays">Import all<span class="seo">replays</span></button>
							</div>
						</div>
					</section>
				</relays>

				<accounts inline-template v-bind:class="['component', {active:route == 'accounts'}]">
					<section id="accounts">
						<div class="wrap">
							<h2>Accounts</h2>
							<ul class="notes">
								<li title="Use private browsing or clear your localStorage to remove all data from your browser">Your browser stores one or more accounts.</li>
								<li>An account consists of a username and an encryption key pair.</li>
								<li>Your public key is shared with relays while your private key is kept secret <span title="or you can export your username and keys">in your browser.</span></li>
								<li>To "login" you must have your username and key pair.</li>
								<li>After 7 days of account inactivity the relay will forget you and someone else can claim your username.</li>
							</ul>
						</div>
						<form ref="frmAccounts" class="bg-purp">
							<div class="wrap">
								<div class="scroll-wrap">
									<!-- TODO: XSRF TOKEN -->
									<table>
										<thead>
											<tr>
												<th>Username</th>
												<th>Public Key</th>
												<th>Private Key</th>
												<th>Actions</th>
											</tr>
										</thead>
										<tbody>
											<tr v-for="(account, index) in accounts">
												<td>{{account.username}}</td>
												<td>{{account.publicKey}}</td>
												<td>
													<div class="check-wrap">
														<input v-bind:id="'chkAccountShowPrivate_' + account.username" type="checkbox" v-model="account.showPrivate"/>
														<label v-bind:for="'chkAccountShowPrivate_' + account.username">
															{{!account.showPrivate ? "Show" : "Hide"}}
														</label>
													</div>
													<span class="private">
														{{account.privateKey}}
													</span>
												</td>
												<td>
													<button class="btn" v-on:click="handler_account_remove($event, account, index)" title="Remove this account from your browser">Remove</button>
													<button class="btn" v-on:click="handler_account_export($event, account)" title="Export this account to a downloadable json file">Export</button>
													<button class="btn" v-on:click="handler_account_change($event, account)" title="Generate new keys and register the new public key with the relay">Change keys</button>
												</td>
											</tr>
											<tr>
												<td>
													<div class="input-wrap">
														<label for="txtAccountUsername" class="seo">Username</label>
														<input type="text" id="txtAccountUsername" v-model="accountNew.username" placeholder="Username" required minlength="1" maxlength="32" pattern="^[\w-]+$" autocomplete="off"/>
													</div>
												</td>
												<td colspan="2">
													<span>Key pair will be generated upon add</span>
												</td>
												<td>
													<button class="btn" type="submit" v-on:click="handler_account_add($event)" title="Add this account to your browser">Add</button>
												</td>
											</tr>
										</tbody>
									</table>
									<div class="btn-wrap">
										<button class="btn" v-on:click="handler_account_import($event)" title="Import an account from your device into your browser">Import</button>
									</div>
								</div>
							</div>
						</form>
						<div class="wrap">
							<div class="btn-wrap">
								<button class="btn" v-on:click="handler_accounts_export" title="Export all accounts to a downloadable json file">Export all<span class="seo">accounts</span></button>
								<button class="btn" v-on:click="handler_accounts_import" title="Import a json file from your device and populate all accounts">Import all<span class="seo">accounts</span></button>
							</div>
						</div>
					</section>
				</accounts>

				<section id="chat" class="wrap" v-if="route == ''">
					<h2>Chat</h2>
				</section>

			</main>
			<footer v-cloak>
				<div class="wrap">
					<p>&copy;2019 AJ Savino</p>
					<!-- TODO: This should download from the relay rather than github to ensure mirrors -->
					<a href="https://github.com/koga73/paranoid/releases" target="_blank">Download source code</a>
				</div>
			</footer>
		</div>
	</body>

	<script>
		/* This can be changed by the server if desired */
		var ServerDefaults = {
			"preferences":{
				"ciphers":[
					{
						"name":"SHA-512",
						"source":"/js/cipher-plugins/sha512.js",
						"type":"hash"
					},
					{
						"name":"RSA-4096",
						"source":"/js/cipher-plugins/rsa4096.js",
						"type":"asymmetric"
					},
					{
						"name":"AES-CBC-256",
						"source":"/js/cipher-plugins/aes256.js",
						"type":"symmetric"
					}
				]
			}
		};
	</script>

	<script src="js/_lib/vue.js"></script>
	<script src="js/site.js"></script>
</html>